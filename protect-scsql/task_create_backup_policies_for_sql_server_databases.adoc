---
permalink: protect-scsql/task_create_backup_policies_for_sql_server_databases.html 
sidebar: sidebar 
keywords: backup policy 
summary: SnapCenter를 사용하여 SQL Server 리소스를 백업하기 전에 리소스 또는 리소스 그룹에 대한 백업 정책을 만들거나 리소스 그룹을 만들거나 단일 리소스를 백업할 때 백업 정책을 만들 수 있습니다. 
---
= SQL Server 데이터베이스에 대한 백업 정책을 생성합니다
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapCenter를 사용하여 SQL Server 리소스를 백업하기 전에 리소스 또는 리소스 그룹에 대한 백업 정책을 만들거나 리소스 그룹을 만들거나 단일 리소스를 백업할 때 백업 정책을 만들 수 있습니다.

.시작하기 전에
* 데이터 보호 전략을 정의해야 합니다.
* SnapCenter 설치, 호스트 추가, 리소스 식별 및 스토리지 시스템 접속 생성과 같은 작업을 완료하여 데이터 보호를 위한 준비를 갖추어야 합니다.
* 로그 백업을 위해 호스트 로그 디렉토리를 구성해야 합니다.
* SQL Server 리소스를 새로 고친(검색된) 상태여야 합니다.
* 미러나 볼트에 스냅샷을 복제하는 경우, SnapCenter 관리자는 소스 볼륨과 타겟 볼륨 모두에 대한 SVM(스토리지 가상 머신)을 할당해야 합니다.
+
관리자가 사용자에게 리소스를 할당하는 방법에 대한 자세한 내용은 SnapCenter 설치 정보를 참조하십시오.

* powershellProcessforScripts 매개 변수의 값을 web.config 파일에서 true 로 설정하여 powerpare 및 postscripts 로 PowerShell 스크립트를 실행해야 합니다.
+
기본값은 false 입니다.

* SnapMirror 활성 동기화에 대한 사전 요구사항 및 제한 사항을 검토하십시오. 자세한 내용은 을 https://docs.netapp.com/us-en/ontap/smbc/considerations-limits.html#volumes["SnapMirror 활성 동기화에 대한 개체 제한"]참조하십시오.


.이 작업에 대해
* 백업 정책은 백업을 관리 및 유지하는 방법과 리소스 또는 리소스 그룹을 백업하는 빈도를 제어하는 규칙의 집합입니다. 또한 복제 및 스크립트 설정을 지정할 수 있습니다. 정책에 옵션을 지정하면 다른 리소스 그룹에 대한 정책을 다시 사용할 때 시간이 절약됩니다.
+
scripts_path는 플러그인 호스트의 SMCoreServiceHost.exe.Config 파일에 있는 PredefinedWindowsScriptsDirectory 키를 사용하여 정의됩니다.

+
필요한 경우 이 경로를 변경하고 SMcore 서비스를 다시 시작할 수 있습니다. 보안을 위해 기본 경로를 사용하는 것이 좋습니다.

+
키 값은 swagger에서 API:API/4.7/configsettings를 통해 표시할 수 있습니다

+
Get API를 사용하여 키 값을 표시할 수 있습니다. API 설정은 지원되지 않습니다.

* SnapLock
+
** '특정 기간 동안 백업 복사본 유지' 옵션을 선택한 경우 SnapLock 보존 기간은 언급된 보존 일수보다 작거나 같아야 합니다.
+
스냅샷 잠금 기간을 지정하면 보존 기간이 만료될 때까지 스냅샷이 삭제되지 않습니다.  이로 인해 정책에 지정된 개수보다 많은 수의 스냅샷이 보존될 수 있습니다.

+
ONTAP 9.12.1 이하 버전의 경우, 복원 과정에서 SnapLock 볼트 스냅샷에서 생성된 클론은 SnapLock 볼트 만료 시간을 상속합니다. 스토리지 관리자는 SnapLock 만료 시간 이후 클론을 수동으로 정리해야 합니다.

+

NOTE: 기본 SnapLock 설정은 SnapCenter 백업 정책에서 관리하고 보조 SnapLock 설정은 ONTAP에서 관리합니다.







== 1단계: 정책 이름 생성

. 왼쪽 탐색 창에서 * 설정 * 을 선택합니다.
. 설정 페이지에서 * 정책 * 을 선택합니다.
. New * 를 선택합니다.
. 이름 * 페이지에서 정책 이름과 설명을 입력합니다.




== 2단계: 백업 옵션 구성

. 백업 유형을 선택합니다


[role="tabbed-block"]
====
.전체 백업 및 로그 백업
--
데이터베이스 파일 및 트랜잭션 로그를 백업하고 트랜잭션 로그를 잘라냅니다.

. 전체 백업 및 로그 백업 * 을 선택합니다.
. 각 스냅샷에 대해 백업해야 하는 최대 데이터베이스 수를 입력합니다.
+

NOTE: 여러 백업 작업을 동시에 실행하려면 이 값을 늘려야 합니다.



--
.전체 백업
--
데이터베이스 파일을 백업합니다.

. 전체 백업 * 을 선택합니다.
. 각 스냅샷에 대해 백업해야 하는 최대 데이터베이스 수를 입력합니다.
기본값은 100입니다
+

NOTE: 여러 백업 작업을 동시에 실행하려면 이 값을 늘려야 합니다.



--
.로그 백업
--
. 트랜잭션 로그를 백업합니다.
. Log backup * 을 선택합니다.


--
.백업만 복사
--
. 다른 백업 응용 프로그램을 사용하여 리소스를 백업하는 경우 * 백업만 복사 * 를 선택합니다.


트랜잭션 로그를 그대로 유지하면 모든 백업 애플리케이션이 데이터베이스를 복구할 수 있습니다. 일반적으로 다른 상황에서는 복사 전용 옵션을 사용하지 않아야 합니다.


NOTE: Microsoft SQL은 보조 스토리지에 대해 * 전체 백업 및 로그 백업 * 옵션과 함께 * 복사 전용 백업 * 옵션을 지원하지 않습니다.

--
====
. 가용성 그룹 설정 섹션에서 다음 작업을 수행합니다.
+
.. 기본 백업 복제본에서만 백업합니다.
+
기본 백업 복제본에서만 백업하려면 이 옵션을 선택합니다. 기본 백업 복제본은 SQL Server의 AG에 대해 구성된 백업 기본 설정에 따라 결정되며

.. 백업할 복제본을 선택합니다.
+
운영 AG 복제본 또는 보조 AG 복제본을 백업에 선택합니다.

.. 백업 우선 순위 선택(최소 및 최대 백업 우선 순위)
+
최소 백업 우선 순위 번호와 백업에 대한 AG 복제본을 결정하는 최대 백업 우선 순위 번호를 지정합니다. 예를 들어 최소 우선 순위는 10이고 최대 우선 순위는 50입니다. 이 경우 우선 순위가 10보다 큰 모든 AG 복제본이 백업에 고려됩니다.

+
기본적으로 최소 우선 순위는 1이고 최대 우선 순위는 100입니다.



+

NOTE: 클러스터 구성에서 백업은 정책에 설정된 보존 설정에 따라 클러스터의 각 노드에 유지됩니다. AG의 소유자 노드가 변경되면 보존 설정에 따라 백업이 수행되고 이전 소유자 노드의 백업은 유지됩니다. AG에 대한 보존은 노드 레벨에서만 적용할 수 있습니다.

. 이 정책의 백업 빈도를 예약합니다. On demand *, * Hourly *, * Daily *, * Weekly * 또는 * Monthly * 를 선택하여 일정 유형을 지정합니다.
+
정책에 대해 하나의 일정 유형만 선택할 수 있습니다.

+
image:../media/backup_settings.gif["백업 설정 화면"]

+

NOTE: 리소스 그룹을 생성하는 동안 백업 작업의 스케줄(시작 날짜, 종료 날짜 및 빈도)을 지정할 수 있습니다. 이렇게 하면 동일한 정책 및 백업 빈도를 공유하는 리소스 그룹을 생성할 수 있지만 각 정책에 서로 다른 백업 스케줄을 할당할 수 있습니다.

+

NOTE: 오전 2시에 예약된 경우 DST(일광 절약 시간) 중에는 일정이 트리거되지 않습니다.





== 3단계: 보존 설정을 구성합니다

보존 페이지에서 백업 유형 페이지에서 선택한 백업 유형에 따라 다음 작업 중 하나 이상을 수행합니다.

. 최신 복원 작업에 대한 보존 설정 섹션에서 다음 작업 중 하나를 수행합니다.


[role="tabbed-block"]
====
.특정 사본 수
--
특정 수의 스냅샷만 보존합니다.

. 최근 <number>일 * 에 적용할 수 있는 로그 백업 보존 옵션을 선택하고 보존할 일 수를 지정합니다. 이 제한에 근접하면 이전 복사본을 삭제할 수 있습니다.


--
.특정 일 수입니다
--
백업 사본을 특정 기간 동안 보관합니다.

. 마지막 <number>일간의 전체 백업 기간 * 에 적용할 수 있는 로그 백업 보존 옵션을 선택하고 로그 백업 사본을 보관할 일 수를 지정합니다.


--
====
. 필요 시 보존 설정에 대한 * 전체 백업 보존 설정 * 섹션에서 다음 작업을 수행합니다.
+
.. 유지할 총 스냅샷 수를 지정합니다
+
... 보존할 스냅샷 수를 지정하려면 * 유지할 스냅샷 사본 합계 * 를 선택합니다.
... 스냅샷 수가 지정된 수를 초과하면 가장 오래된 복제본이 먼저 삭제되고 스냅샷이 삭제됩니다.







IMPORTANT: 기본적으로 보존 횟수 값은 2로 설정됩니다. 보존 횟수를 1로 설정하면 새 스냅샷이 타겟으로 복제될 때까지 첫 번째 스냅샷이 SnapVault 관계에 대한 참조 스냅샷이기 때문에 보존 작업이 실패할 수 있습니다.


NOTE: 최대 보존 값은 ONTAP 9.4 이상의 리소스에 대해 1018이고, ONTAP 9.3 이전 버전의 리소스에 대해서는 254입니다. 보존이 기본 ONTAP 버전에서 지원하는 값보다 높은 값으로 설정된 경우 백업이 실패합니다.

. 스냅샷을 보관할 시간입니다
+
.. 스냅샷을 삭제하기 전에 보존할 일 수를 지정하려면 * Keep Snapshot copies for * 를 선택합니다.


. 스냅샷 잠금 기간을 지정하려면 * Snapshot copy locking period * 를 선택하고 일, 월 또는 연도를 선택합니다.
+
SnapLock 보존 기간은 100년 미만이어야 합니다.



. 시간별, 일별, 주별 및 월별 보존 설정의 * 전체 백업 보존 설정 * 섹션에서 백업 유형 페이지에서 선택한 스케줄 유형에 대한 보존 설정을 지정합니다.
+
.. 유지할 총 스냅샷 수를 지정합니다
+
... 보존할 스냅샷 수를 지정하려면 * 유지할 스냅샷 사본 합계 * 를 선택합니다. 스냅샷 수가 지정된 수를 초과하면 가장 오래된 복제본이 먼저 삭제되고 스냅샷이 삭제됩니다.







IMPORTANT: SnapVault 복제를 설정하려면 보존 수를 2 이상으로 설정해야 합니다. 보존 횟수를 1로 설정하면 새 스냅샷이 타겟으로 복제될 때까지 첫 번째 스냅샷이 SnapVault 관계에 대한 참조 스냅샷이기 때문에 보존 작업이 실패할 수 있습니다.

. 스냅샷을 보관할 시간입니다
+
.. 스냅샷을 삭제하기 전에 보존할 일 수를 지정하려면 * Keep Snapshot copies for * 를 선택합니다.


. 스냅샷 잠금 기간을 지정하려면 * Snapshot copy locking period * 를 선택하고 일, 월 또는 연도를 선택합니다.
+
SnapLock 보존 기간은 100년 미만이어야 합니다.

+
로그 스냅샷 보존은 기본적으로 7일로 설정됩니다. Set-SmPolicy cmdlet을 사용하여 로그 스냅샷 보존을 변경합니다.



이 예에서는 로그 스냅샷 보존을 2로 설정합니다.

.예제 보기
[]
====
Set-SmPolicy-PolicyName 'newpol' - PolicyType 'Backup' - PluginPolicyType 'CSQL' - sqlbackuptype 'FullBackupAndLogBackup' - RetenionSettings@{BackupType='DATA'; ScheduleType='Hourly'; RetentionCount = 2}, @{BackupenetSnapshot'; ScheduleType = 'ScheduleReturetEnretionCount'

====
https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/SnapCenter_retains_Snapshot_copies_of_the_database["SnapCenter은 데이터베이스의 스냅샷 복사본을 유지합니다"]



== 4단계: 복제 설정을 구성합니다

. 복제 페이지에서 보조 스토리지 시스템에 대한 복제를 지정합니다.


[role="tabbed-block"]
====
.SnapMirror를 업데이트합니다
--
로컬 스냅샷 복사본을 생성한 후 SnapMirror를 업데이트합니다.

. 다른 볼륨(SnapMirror)에 백업 세트의 미러 복사본을 생성하려면 이 옵션을 선택합니다.
+
이 옵션은 SnapMirror 액티브 동기화에 대해 활성화해야 합니다.

+
보조 복제 중에 SnapLock 만료 시간에 운영 SnapLock 만료 시간이 로드됩니다. 토폴로지 페이지에서 * 새로 고침 * 버튼을 클릭하면 ONTAP에서 검색된 2차 및 1차 SnapLock 만료 시간이 새로 고쳐집니다.

+
을 link:task_view_sql_server_backups_and_clones_in_the_topology_page.html["토폴로지 페이지에서 SQL Server 백업 및 클론 보기"]참조하십시오.



--
.SnapVault를 업데이트합니다
--
스냅샷 복사본을 생성한 후 SnapVault를 업데이트합니다.

. 디스크 간 백업 복제를 수행하려면 이 옵션을 선택합니다.
+
보조 복제 중에 SnapLock 만료 시간에 운영 SnapLock 만료 시간이 로드됩니다. 토폴로지 페이지에서 * 새로 고침 * 버튼을 클릭하면 ONTAP에서 검색된 2차 및 1차 SnapLock 만료 시간이 새로 고쳐집니다.

+
SnapLock가 SnapLock 볼트라고 하는 ONTAP의 보조 버전에서만 구성된 경우 토폴로지 페이지에서 * 새로 고침 * 버튼을 클릭하면 ONTAP에서 검색된 보조 시스템의 잠금 기간이 새로 고쳐집니다.

+
SnapLock 볼트에 대한 자세한 내용은 을 참조하십시오 https://docs.netapp.com/us-en/ontap/snaplock/commit-snapshot-copies-worm-concept.html["볼트 대상에서 WORM에 스냅샷 복사본을 커밋합니다"]

+
을 link:task_view_sql_server_backups_and_clones_in_the_topology_page.html["토폴로지 페이지에서 SQL Server 백업 및 클론 보기"]참조하십시오.



--
.보조 정책 레이블
--
. 스냅샷 레이블을 선택합니다.


선택한 스냅샷 레이블에 따라 ONTAP은 해당 레이블과 일치하는 보조 스냅샷 보존 정책을 적용합니다.


NOTE: 로컬 스냅샷 복사본 * 을 생성한 후 SnapMirror 업데이트 * 를 선택한 경우, 선택적으로 보조 정책 레이블을 지정할 수 있습니다. 그러나 로컬 스냅샷 복사본 * 을 생성한 후 * SnapVault 업데이트 * 를 선택한 경우에는 보조 정책 레이블을 지정해야 합니다.

--
.오류 재시도 횟수
--
. 프로세스가 중지되기 전에 수행해야 하는 복제 시도 횟수를 입력합니다.


--
====


== 5단계: 스크립트 설정을 구성합니다

. 스크립트 페이지에서 백업 작업 전후에 실행해야 하는 처방인 또는 PS의 경로와 인수를 각각 입력합니다.
+
예를 들어 스크립트를 실행하여 SNMP 트랩을 업데이트하고, 경고를 자동화하고, 로그를 보낼 수 있습니다.

+

NOTE: 처방자 또는 사후 스크립트 경로에는 드라이브 또는 공유가 포함되어서는 안 됩니다. 경로는 scripts_path에 상대해야 합니다.

+

NOTE: ONTAP에서 SnapMirror 보존 정책을 구성하여 보조 스토리지가 스냅샷의 최대 제한에 도달하지 않도록 해야 합니다.





== 6단계: 확인 설정 구성

확인 페이지에서 다음 단계를 수행하십시오.

. 다음 백업 스케줄에 대한 확인 실행 섹션에서 스케줄 빈도를 선택합니다.
. 데이터베이스 일관성 검사 옵션 섹션에서 다음 작업을 수행합니다.
+
.. 무결성 구조를 데이터베이스의 물리적 구조로 제한(physical_only)
+
... 무결성 검사를 데이터베이스의 물리적 구조로 제한하고 데이터베이스에 영향을 미치는 찢어진 페이지, 체크섬 오류 및 일반적인 하드웨어 오류를 검색하려면 * 데이터베이스의 물리적 구조로 무결성 구조를 제한합니다(physical_only) * 를 선택합니다.


.. 모든 정보 메시지 표시 안 함(INFOMSGS 없음)
+
... 모든 정보 메시지를 표시하지 않으려면 * 모든 정보 메시지 억제(no_INFOMSGS) * 를 선택합니다. 기본적으로 선택되어 있습니다.


.. 객체별 보고된 모든 오류 메시지 표시(ALL_ERRORMSGS)
+
... 객체별로 보고된 모든 오류 메시지 표시(ALL_ERRORMSGS) * 를 선택하여 객체별로 보고된 모든 오류를 표시합니다.


.. 클러스터링되지 않은 인덱스(NOINDEX) 확인 안 함
+
... 클러스터링되지 않은 인덱스를 선택하지 않으려면 * 클러스터링되지 않은 인덱스(NOINDEX) * 를 선택합니다. SQL Server 데이터베이스는 DBCC(Microsoft SQL Server Database Consistency Checker)를 사용하여 데이터베이스 개체의 논리적 무결성 및 물리적 무결성을 검사합니다.


.. 내부 데이터베이스 스냅샷(TABLOCK)을 사용하는 대신 검사를 제한하고 잠금을 가져옵니다.
+
... 내부 데이터베이스 스냅샷 복사본(TABLOCK)을 사용하는 대신 * 검사를 제한하고 잠금을 획득합니다. * 를 선택하여 내부 데이터베이스 스냅샷을 사용하는 대신 검사를 제한하고 잠금을 획득합니다.




. 로그 백업 * 섹션에서 * 완료 시 로그 백업 확인 * 을 선택하여 완료 시 로그 백업을 확인합니다.
. 검증 스크립트 설정 * 섹션에서 검증 작업 전후에 실행해야 하는 처방인 또는 PS의 경로와 인수를 각각 입력합니다.
+

NOTE: 처방자 또는 사후 스크립트 경로에는 드라이브 또는 공유가 포함되어서는 안 됩니다. 경로는 scripts_path에 상대해야 합니다.





== 7단계: 요약 검토

. 요약을 검토한 후 * Finish * 를 선택합니다.

